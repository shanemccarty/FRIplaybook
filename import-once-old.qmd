---
title: "Importing Data Once"
subtitle: "How to use readr, readxl, and haven"
authors: 
  - Zihan Hei
  - Shane McCarty, PhD
abstract: |
  This chapter introduces students to importing data from various sources and file formats commonly used in public health research. Students learn to load datasets from R packages (NHANES), read CSV files, import Excel spreadsheets, and work with SPSS data files. The chapter demonstrates essential data inspection techniques including viewing data structure, examining headers, and understanding data summaries. Students also learn to handle missing data by recoding special values (-99, -50) as NA during import. By the end of this chapter, students will be equipped to import data from multiple sources and prepare it for analysis in their public health research projects.
keywords:
  - data import
  - csv
  - excel
  - SPSS
  - NHANES
  - missing data
date: 10.20.2025
date-format: "MM.DD.YYYY"
format: live-html
engine: knitr
editor: visual
---

{{< include ./_extensions/r-wasm/live/_knitr.qmd >}}

::: callout-tip
## ðŸ“– import resources

-   [R4DS Book Chapter 4](https://r4ds.hadley.nz/data-import.html)
-   [R4DS Book Chapter 20-24](https://r4ds.hadley.nz/import.html)
-   [Posit Cheatsheet](https://rstudio.github.io/cheatsheets/html/data-import.html?_gl=1*2grk0d*_ga*ODQ0NjUzMTM1LjE3NjA0MDU5Nzk.*_ga_2C0WZ1JHG0*czE3NjA0OTMzNDgkbzMkZzAkdDE3NjA0OTMzNDgkajYwJGwwJGgw)
-   [PDF Cheatsheet](https://rstudio.github.io/cheatsheets/data-import.pdf)
:::

::: {.callout-caution collapse="true"}
## Page Update

On October 20th, 2025 at 11:35pm, much of the code was updated to tag missing data correctly. Responses (NA, -99, and -50) will be changed to `NA`.
:::

```{r}
#| include: false
current_date <- format(Sys.Date(), "%m.%d.%Y")

```

## Introduction to Data Import

**Importing data** is the *first step* in the data science workflow. Before you can clean, visualize, or model your data, you need to get it into R. Public health researchers work with data from many sources and in many formats. In FRI-PH, we will import data from a survey collected in the software Qualtrics.

**Common data sources:**

-   Survey platforms (Qualtrics, REDCap)

-   R packages (e.g., `NHANES`)

-   Other statistical softwares (e.g., SPSS, SAS, Stata)

-   Spreadsheets (Excel, Google Sheets)

-   Databases (SQL)

```{r}
#| label: load-packages
#| autorun: true
#| completion: true
#| warning: false
#| message: false

# Load packages (do this each session)
library(NHANES)    # CDC health data
library(tidyverse) # Data wrangling (includes readr)
library(readxl)    # Read Excel files
library(haven)     # Read SPSS/SAS/Stata files
```

## Datasets

You will learn how to import different datasets:

-   datasets in R packages `NHANES` and `YRBS`

-   class dataset "health beliefs (cohort 11) collected in the Research Methods I (ANTH206) course

-   team dataset "oralhealth"

### File Formats

-   National Health and Nutrition Examination Survey dataset from the Centers for Disease Control and Prevention (CDC) using the R package `NHANES`

-   a `.csv` file format of the class dataset "health beliefs (cohort 11)" collected in the Research Methods I (ANTH206) course `03.15.2025.prolifichealthbeliefs.csv`

-   a `.xlsx` file format of the class dataset "health beliefs (cohort 11) collected in the Research Methods I (ANTH206) course `03.15.2025.prolifichealthbeliefs.xlsx`

-   a `.sav` file format from SPSS of the FRI team project on oral health `10.31.2024.oralhealth.sav`.

## Import Examples

### Import from `NHANES` package

```{r}
#| label: install NHANES
install.packages("NHANES")
```

### Load libraries

```{r}
#| autorun: false
#| completion: true
#| echo: true
#| output: true
#| warning: false
#| error: false

library(tidyverse)
library(psych)
library(knitr)
library(tibble)
library(dplyr)
library(tidyr)
library(scales)     # for number formatting like comma()
library(english)    # to convert numbers to words
library(stringr)    # for text functions like str_c()
library(NHANES)
```

#### Column Names

Review the column names (aka the variables) in the dataset.

```{webr-r}
#| label: names-NHANES
library(NHANES)
names(NHANESraw)
```

#### Data Structure

Now, you will view the structure of the NHANES data

```{webr-r}
#| label: data-structure-NHANES
str(NHANESraw)
```

#### Data Header

Review the first 10 responses for the first 6 columns

```{webr-r}
library(NHANES)
NHANESraw[1:10, 1:6] 
```

#### View Data

In Posit Cloud, you can use `View()` in your CONSOLE to view the dataframe.

```{{r}}
library(NHANES)
# View data
View(NHANESraw)
```

### Example. Import`.xlsx` file with 1 header (first row)

Excel files (.xlsx or .xls) are common in public health. Use the `readxl` package to import them. Below are code chunks that can be copied into your report if you are using an excel file with **1 header**.

Use the .clean datafile: `r current_date`.data.team1.clean.xlsx . 

- Notice: the file path has "data/`r current_date`.data.team1.clean.xlsx" because the folder (data) is holding the Posit Cloud file (`r current_date`.data.team1.clean.xlsx). You do NOT need to put your file inside of a "data" folder, but you do need to UPLOAD your dataset to your files in Posit Cloud. 



```{r}
#| label: import-excel-header1
#| autorun: true
#| completion: true
#| echo: true
#| output: false
#| warning: false
#| error: false

library(readxl)
# Import Excel file
safetydata <- read_excel("10.20.2025.data.team1.clean.xlsx", col_names = TRUE)

safetydata[safetydata == -99] <- NA
safetydata[safetydata == -50] <- NA

##explanation: all -99 and -50 data will be treated as missing data
```

```{r}
# View first 10 rows
head(safetydata, 10)
```

```{r}
# View column names, which are the VARIABLES
names(safetydata)
```

```{r}
# Get a summary of all variables
summary(safetydata)
```

### Option 2. Import`.xlsx` file with 2 row header (first 2 rows)

If you do NOT clean your data and want to import the exact file you exported from the Qualtrics. You can skip the step of manually deleting row 2 (see exporting data chapter) and import a 2 row header with the following code.

Use the not clean datafile: `r current_date`.data.team1.xlsx

```{{r}}
#| label: import-excel-header2

library(readxl)

# Import Excel file using readxl only
# Row 1: Variable names (used as header)
# Row 2: Variable labels (SKIP this row)
# Row 3+: Actual data

# Step 1: Read row 1 to get variable names
safetydata2 <- read_excel(
  path = "10.20.2025.data.team1.clean.xlsx",
  sheet = 1,
  n_max = 1,
  col_names = FALSE
)

# Convert to character vector
var_names <- as.character(var_names[1, ])

```

```{{r}}

# Step 2: Read the actual data starting from row 3
safetydata2 <- read_excel(
  path = "10.20.2025.data.team1.clean.xlsx",
  sheet = 1,
  skip = 2,  # Skip rows 1 and 2
  col_names = var_names,  # Use row 1 as column names
  na = c("", "NA", "-99", "-50")  # Define missing value codes
)
```

#### Excel: Import Data to assign Missing Data as `NA`

::: callout-tip
This page has been updated to address missing data during import. 
:::
