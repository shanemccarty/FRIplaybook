{
  "hash": "d337648e9840cca29413164d0918b07b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Importing Qualtrics Data Live\"\nsubtitle: \"How to use the QualtrRics R package\"\nauthor: \"Gavin Rualo\"\nabstract: |\n  This chapter demonstrates how to programmatically download survey data from Qualtrics\n  using the Qualtrics API. Students learn to authenticate with Qualtrics, initiate data\n  exports, and download responses directly into R for real-time analysis and reporting.\n  This approach enables automated data updates and live dashboards that reflect the most\n  current survey responses without manual downloads. Using this approach, a research team should be able to run analyses during the last week before the poster is submitted to maximize the data collection window.\nformat: html\nengine: knitr\neditor: visual\nexecute:\n  eval: false  # Don't run the code automatically\n  echo: true\n---\n\n::: {.callout-tip icon=\"false\"}\n## ðŸ“– `qualtrRics` resources\n\n- [Documentation](https://cran.r-project.org/web/packages/qualtRics/vignettes/qualtRics.html)\n- [Qualtrics website](https://api.qualtrics.com/docs/)\n\n:::\n\n## Benefits of `qualtRics` Continuous Importing of Survey Data\nBy importing data continously using the `qualtRics` R package, you do not need to export from qualtrics and upload/import a data file. You can generate with up-to-date data instaneously for a:  \n- Quarto report \n- Plots in a shiny app \n- Quarto presentation, such as a live demonstration with survey data collected moments ago or to show what your code can do \n\n## Getting necessary qualtrics information\n\n![Qualtrics Info](images/qualtrics_info_ex.png)\n\nWhen you log into Qualtrics, you're going to need to retrieve a few pieces of data specific to your account and the survey that you want to get live data from. Here, we've clicked our user icon in the top right and gone to \"Account Settings.\" You're going to need these strings later.\n\nNext, you're going to need your survey ID. When you click on the survey that you're getting live data from, the URL will look something like this: https://binghamton.yul1.qualtrics.com/survey-builder/SV_6mOC1SaJbecAuP0/edit The survey ID is the string between survey-builder/ and /edit, in this case, being \"SV_6mOC1SaJbecAuP0\"\n\nGetting into the actual code, we have the following steps: \\## Import necessary packages:\n\n\n::: {.cell autorun='false' completion='true'}\n\n```{.r .cell-code}\nlibrary(httr)\nlibrary(jsonlite)\nlibrary(readr)\n```\n:::\n\n\n## Save important info to variables:\n\n\n::: {.cell}\n\n```{.r .cell-code}\napi_token <- \"1V0X29BHlwPfSYPsUMQ5d8tQfeydhsVBcGQ2v9Bw\"\ndata_center <- \"yul1\"\nsurvey_id <- \"SV_6mOC1SaJbecAuP0\"\n\nbase_url <- paste0(\"https://\", data_center, \".qualtrics.com/API/v3\")\nheaders <- add_headers(\n  \"X-API-TOKEN\" = api_token,\n  \"Content-Type\" = \"application/json\"\n)\n```\n:::\n\n\nIn this chunk, after saving our API key and survey ID info, we construct the URL that we are going to scrape using the paste0 function (which just combines the arguments into a single string with no spaces between them). We add these specific headers because they are necessary arguments for the API call.\n\n## Start the export job\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstart_response_export <- function(survey_id) {\n  url <- paste0(base_url, \"/surveys/\", survey_id, \"/export-responses\")\n  body <- list(format = \"csv\")  # Use CSV format here\n  res <- POST(url, headers, body = toJSON(body, auto_unbox = TRUE))\n  stop_for_status(res)\n  content(res, as = \"parsed\", simplifyVector = TRUE)\n}\n```\n:::\n\n\nThis chunk creates the API endpoint and allows us to begin exporting. It also gives us a progress report on how close the data is to being exported!\n\n## Poll for export completion\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheck_export_progress <- function(progress_id) {\n  url <- paste0(base_url, \"/surveys/\", survey_id, \"/export-responses/\", progress_id)\n  repeat {\n    res <- GET(url, headers)\n    stop_for_status(res)\n    progress <- content(res, as = \"parsed\", simplifyVector = TRUE)\n    if (progress$result$status == \"complete\") {\n      return(progress$result$fileId)\n    } else if (progress$result$status == \"failed\") {\n      stop(\"Export failed\")\n    }\n    Sys.sleep(2)\n  }\n}\n```\n:::\n\n\nOnce the export is ready, this chunk returns the ID for the file that we can now download from the API.\n\n## Download and read CSV file\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndaily_download_responses_csv <- function(file_id) {\n  url <- paste0(base_url, \"/surveys/\", survey_id, \"/export-responses/\", file_id, \"/file\")\n  res <- GET(url, headers)\n  stop_for_status(res)\n  tmp <- tempfile(fileext = \".zip\")\n  writeBin(content(res, \"raw\"), tmp)\n  unzip_dir <- tempdir()\n  unzip(tmp, exdir = unzip_dir)\n  csv_file <- list.files(unzip_dir, pattern = \"*.csv\", full.names = TRUE)\n  read_csv(csv_file)\n}\n```\n:::\n\n\nThis chunk unpacks the output into a .csv file which makes it ready for analysis!\n\n## Main execution\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexport_response <- start_response_export(survey_id)\nprogress_id <- export_response$result$progressId\nfile_id <- check_export_progress(progress_id)\nresponses_df <- daily_download_responses_csv(file_id)\n```\n:::\n\n\nFinally, we set up our dataframes. These dataframes are now in your environment and can update charts or tables every time you reload the export!\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}