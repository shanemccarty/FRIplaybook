{
  "hash": "029a35af2a20b662bfe55ba3b2d89ba9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Visualize data in ggplot2\"\nsubtitle: \"How to produce publication-ready plots\"\nauthor:\n  - Andrew Silhavy\n  - Shane McCarty, PhD\nabstract: |\n  This chapter introduces students to the ggplot2 package, a powerful tool for creating sophisticated and publication-ready data visualizations in R. Students learn the foundational \"grammar of graphics\" approach, which builds plots layer by layer using seven core components: data, mapping, geometries, facets, statistics, coordinates, and  themes. Through hands-on examples using insurance data, the chapter demonstrates how to construct various plot types including scatterplots, bar plots, and violin plots. \n  Students explore how to visualize relationships between variables, incorporate grouping variables using color and faceting, and customize plots with titles, labels, and themes. By the end of this chapter, students will understand how to select appropriate visualizations based on data types and create professional-quality figures for their public health research.\nkeywords:\n  - ggplot2\n  - data visualization\n  - grammar of graphics\n  - R\n  - exploratory data analysis\ndate: 10.21.2025\ndate-format: \"MM.DD.YYYY\"\nformat: html\neditor: visual\nexecute:\n  warning: false\n  message: false\n---\n\n::: callout-tip\n## ðŸ“– `ggplot2` resources\n\n-   [Intro to ggplot2](https://ggplot2.tidyverse.org/articles/ggplot2.html)\n-   [Documentation](https://ggplot2.tidyverse.org)\n-   [R4DS Book Chapter 1](https://r4ds.hadley.nz/data-visualize.html)\n-   [R4DS Book Ch. 9 - 11](https://r4ds.hadley.nz/visualize.html)\n-   [ggplot2 Book](https://ggplot2-book.org)\n-   [Datacamp](https://www.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2)\n-   [Posit Cheatsheet](https://rstudio.github.io/cheatsheets/html/data-visualization.html)\n-   [PDF Cheatsheet](https://rstudio.github.io/cheatsheets/data-visualization.pdf)\n:::\n\n::: {.callout-important appearance=\"simple\"}\n## Required\n\nYour *R&D Report* and *R&D Team Manuscript* should include [ggsave( )](#save) information so you can export your plots quickly and add them to the poster.\n:::\n\n## Example Data: Insurance Charges\n\nThe example dataset is entitled \"Medical Cost Personal Costs\" from [Kaggle](#0).\n\n### Load and Import\n\nTo install and load ggplot2:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"ggplot2\")\n```\n:::\n\n\nLet's start by loading our dataset and exploring it:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninsurance <- read.csv(\"data/insurance.csv\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n```\n:::\n\n\n### Summarize `insurance` data\n\nLet's learn more about our data with `summary()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(insurance)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      age            sex                 bmi           children    \n Min.   :18.00   Length:1338        Min.   :15.96   Min.   :0.000  \n 1st Qu.:27.00   Class :character   1st Qu.:26.30   1st Qu.:0.000  \n Median :39.00   Mode  :character   Median :30.40   Median :1.000  \n Mean   :39.21                      Mean   :30.66   Mean   :1.095  \n 3rd Qu.:51.00                      3rd Qu.:34.69   3rd Qu.:2.000  \n Max.   :64.00                      Max.   :53.13   Max.   :5.000  \n    smoker             region             charges     \n Length:1338        Length:1338        Min.   : 1122  \n Class :character   Class :character   1st Qu.: 4740  \n Mode  :character   Mode  :character   Median : 9382  \n                                       Mean   :13270  \n                                       3rd Qu.:16640  \n                                       Max.   :63770  \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(insurance, 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   age    sex    bmi children smoker    region   charges\n1   19 female 27.900        0    yes southwest 16884.924\n2   18   male 33.770        1     no southeast  1725.552\n3   28   male 33.000        3     no southeast  4449.462\n4   33   male 22.705        0     no northwest 21984.471\n5   32   male 28.880        0     no northwest  3866.855\n6   31 female 25.740        0     no southeast  3756.622\n7   46 female 33.440        1     no southeast  8240.590\n8   37 female 27.740        3     no northwest  7281.506\n9   37   male 29.830        2     no northeast  6406.411\n10  60 female 25.840        0     no northwest 28923.137\n```\n\n\n:::\n:::\n\n\n## The Seven Components of ggplot2\n\nThink of building a ggplot like making a layered lasagna - you add one component at a time to create the final product.\n\n![*In ggplot2, add layers as you would in making lasagna*](images/ggplot2-lasagna.png)\n\nThe seven components are:\n\n1.  **Data**: The dataset you're visualizing\n\n2.  **Mapping**: Which variables go on which axes (aesthetics)\n\n3.  **Geometries**: The type of plot (points, lines, bars, etc.)\n\n4.  **Facets**: Subplots based on categorical variables\n\n5.  **Statistics**: Statistical transformations of the data\n\n6.  **Coordinates**: The coordinate system (usually Cartesian)\n\n7.  **Theme**: Visual styling and appearance\n\n[![source: \\[ggplot2.tidyverse.org\\](https://ggplot2.tidyverse.org/articles/ggplot2.html)](images/ggplot2-layers.png){fig-alt=\"the image includes 7 colors for each of the 7 layers\"}](https://ggplot2.tidyverse.org/articles/ggplot2.html)\n\n### Understanding Data Types\n\nBefore creating visualizations, it's important to understand your data types:\n\n**Qualitative Data:**\n\n-   ðŸ·ï¸ **Nominal Data**: Categories without any order (e.g., Red, Green, Blue)\n\n-   ðŸ“¶ **Ordinal Data**: Categories with some order (e.g., Small, Medium, Large)\n\n**Quantitative Data:**\n\n-   ðŸ”¢ **Discrete**: Countable data (e.g., number of people in a room)\n\n-   ðŸ“ **Continuous**: Measurable data (e.g., height, weight)\n\n## Decision Tree\n\nYour research question can be classified as **comparative** research or **relationship** research ([Barroga & Matanguihan, 2022](https://pubmed.ncbi.nlm.nih.gov/35470596/)).\n\n![*The decision tree helps researchers to identify the specific statistical technique based on their comparative or relationship research question*](images/ggplot2-decision.png)\n\n### Relationship Research\n\nFor relationship research, the variables are ðŸ“ **Continuous** because they range along a continuum, such as a scale for beliefs from 1 (strongly disagree) to 6 (strongly agree). To examine the relationship between two continous variables, use the steps below to build a custom scatterplot.\n\n#### STEP-BY-STEP TO BUILD A SCATTERPLOT \n\n#### Step 1: Set up data and mapping\n\nWhat is the relationship between BMI and insurance charges?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = insurance,\n       mapping = aes(\n         x = bmi,\n         y = charges))\n```\n\n::: {.cell-output-display}\n![](ggplot2_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\nThis creates a blank canvas with our axes defined, but no data displayed yet!\n\n#### Step 2: Add geometry (points)\n\nAdd points to create a scatterplot using `geom_point()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = insurance,\n       mapping = aes(\n         x = bmi,\n         y = charges)) + geom_point()\n```\n\n::: {.cell-output-display}\n![](ggplot2_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n#### Step 3: Add a statistical layer (trend line)\n\nAdd a linear model line with `geom_smooth()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = insurance,\n       mapping = aes(\n         x = bmi,\n         y = charges)) + geom_point() +\n  geom_smooth(method = \"lm\")\n```\n\n::: {.cell-output-display}\n![](ggplot2_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nNotice how it looks like we have two different populations? Let's explore this further.\n\n#### Optional â€“ Step 4. Incorporate grouping (color)\n\nThere are two main approaches to visualizing grouping variables:\n\n##### Method 1: Using Color\n\nMap the `smoker` variable to color:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = insurance,\n       mapping = aes(\n         x = bmi,\n         y = charges)) + geom_point() +\n  geom_smooth(method = \"lm\")\n```\n\n::: {.cell-output-display}\n![](ggplot2_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n##### Method 2: Using Facets\n\nCreate separate panels for each group with `facet_wrap()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = insurance,\n       mapping = aes(\n         x = bmi,\n         y = charges)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") +\n  facet_wrap(~smoker)\n```\n\n::: {.cell-output-display}\n![](ggplot2_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nBoth methods reveal that smoking status significantly affects the relationship between BMI and insurance charges!\n\n#### Step 5. Customize Appearance\n\n##### Adding Titles and Labels\n\nMake your plot more informative with descriptive titles:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = insurance,\n       mapping = aes(\n         x = bmi,\n         y = charges)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") +\n  ggtitle(\"Insurance charges vs \n          BMI for smokers and non-smokers\") +\n  xlab(\"Body Mass Index (BMI)\") +\n  ylab(\"Insurance Charges\")\n```\n\n::: {.cell-output-display}\n![](ggplot2_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n##### Changing the Theme\n\nApply a professional theme with `theme_bw()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = insurance, mapping = aes(x = bmi, y = charges, color = smoker)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") +\n  ggtitle(\"Insurance charges vs \n          BMI for smokers and non-smokers\") +\n  xlab(\"Body Mass Index (BMI)\") +\n  ylab(\"Insurance Charges\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![a scatterplot depicting a linear relationship between BMI and insurance charges](ggplot2_files/figure-html/ggplot with black and white theme-1.png){width=768}\n:::\n:::\n\n\n::: {.callout-important appearance=\"simple\"}\n## Select a theme\n\nTeam members should pick **one theme** (from the [complete themes](https://ggplot2.tidyverse.org/reference/ggtheme.html)) to use with all plots in the individual reports and the team manuscript!\n:::\n\n##### Adjusting Axis Scales\n\nSometimes, you need to manually control the range of your axes for better visualization or to match other plots or to capture the entire range of the possible response options (e.g., 1-6, 1-10, 1 - 100). \n\nSet specific limits with `xlim()` and `ylim()`. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = insurance, \n       mapping = aes(x = bmi, y = charges, color = smoker)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") +\n  xlim(15, 55) +  # Set x-axis from 15 to 55\n  ylim(0, 65000) +  # Set y-axis from 0 to 65000\n  ggtitle(\"Insurance charges vs BMI for smokers and non-smokers\") +\n  xlab(\"Body Mass Index (BMI)\") +\n  ylab(\"Insurance Charges\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](ggplot2_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n::: {.callout-warning}\n## Warning: Data outside limits will be removed\nUsing `xlim()` and `ylim()` removes any data points outside the specified range. This can affect trend lines!\n:::\n\n::: {.callout-important appearance=\"simple\"}\n## Requirement: X and Y Axes\n\nIf your response options range from 1 to 6. Use `ylim( )` to adjust the y-axis to range from 1 to 6 too. \n:::\n\n##### Using Colors\n\nWant to improve your plots with colors?\n\n-   [4 ways to use colors in ggplot2 more efficiently](https://albert-rapp.de/posts/ggplot2-tips/07_four_ways_colors_more_efficiently/07_four_ways_colors_more_efficiently.html)\n\n-   [Dealing with colors in ggplot2](https://r-graph-gallery.com/ggplot2-color.html)\n\n-   [Customizing ggplot2 color and fill scales](https://sjspielman.github.io/introverse/articles/color_fill_scales.html)\n\n-   [How to use better colors in ggplot (youtube)](https://www.youtube.com/watch?v=ZVSbY4z7tMY)\n\n### Comparative Research\n\nComparative research questions examine mean score differences on a continuous (quantitative) variable based on real or artificial (researcher-decided) group membership. Simply put, comparative research offers a way of comparing different categories to one another. These categories can be:\n\n-    ðŸ·ï¸ **Nominal Data** (Gender Identity)\n\n    -   Man\n    -   Woman\n    -   Non-Binary\n\n-   ðŸ“¶ **Ordinal Data** (Age Group)\n\n    -   18 - 35\n    -   36 - 54\n    -   55 - 75\n    -   76+\n\n#### STEP-BY-STEP TO BUILD A BARPLOT WITH `geom_bar()`\n\nBar plots are useful for comparing mean scores across groups.\n\n#### Step 1: Set up data and mapping\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_region_charges <- ggplot(\n  data = insurance,\n  mapping = aes(\n    x = region,\n    y = charges)\n  )\n\n## there is nothing to see yet! \n```\n:::\n\n\n#### Step 2: Add geometry (bars)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_region_charges <- ggplot(\n  data = insurance,\n  mapping = aes(\n    x = region,\n    y = charges)) +\n  geom_bar(stat = 'summary', fun = 'mean')\n```\n:::\n\n\n#### Step 3: Customize bars\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_region_charges <- ggplot(\n  data = insurance,\n  mapping = aes(\n    x = region,\n    y = charges)) +\n  geom_bar(\n    stat = 'summary',\n    fun = 'mean',\n    fill = \"#005a43\")\n```\n:::\n\n\n#### Step 4: Add labels and themes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_region_charges <- ggplot(data = insurance, mapping = aes(x = region, y = charges)) + \n  geom_bar(stat = 'summary', fun = 'mean', fill = \"#005a43\") + \n  ggtitle(\"Mean Insurance Charges Based on Region\") + \n  xlab(\"Region\") +\n  ylab(\"Insurance Charges\") +\n  theme_bw()\n```\n:::\n\n\n#### Step 5: save plot as image using `ggsave()`\n\n[ggsave( )](https://ggplot2.tidyverse.org/reference/ggsave.html) is a specific function to save a plot as an image in .jpg or .png image. This plot is saved in your \"files\" folder, which can be exported out of Posit Cloud and then added to your google drive and on to the poster.\n\n::: callout-important\n## Requirement\n\nYou must use file for both your final report and team manuscript.\n\nYour *R&D Report*, *Team R&D Manuscript*, *Final Report*, and *Final Manuscript* must include `ggsave( )` for plots.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Print the plot\nprint(plot_region_charges)\n```\n\n::: {.cell-output-display}\n![](ggplot2_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# save the plot\nggsave(\"plots/plot1:region.png\", \n       plot = plot_region_charges, \n       width = 10, \n       height = 8, \n       dpi = 300)\n```\n:::\n\n\nAfter you run the code, the console will ask you a question. The use of `plots/` in the `ggsave()` code chunk will create a folder called **Plots** in your files within Posit Cloud if you type \"1\" and click return/enter.\n\n![](images/ggplot2-ggsave.png){fig-alt=\"a screenshot of the console output after running the ggsave code\"}\n\nIn your **Files**, click the **Plots** folder. Your location within Posit Cloud is shown below: Cloud \\> project \\> plots. You are in the **Plots**.\n\n![](images/ggplot2-ggsave-plotsfolder.png){fig-alt=\"this is a screenshot of the files within the plot folder of posit cloud\"}\n\nClick the gear icon (above \" project \\> plots\"), click export, and **Download.** Then, upload this the plot and others within your team's google drive \\> Team Survey Data \\> Quant Data \\> Plots.\n\n##### Violin Plots with `geom_violin()`\n\nViolin plots provide a different way to visualize information to capture the distribution of data for each category.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = insurance,\n       mapping = aes(\n         x = smoker,\n         y = charges,\n         fill = smoker)) + \n  geom_violin() +\n  ggtitle(\"Distribution of Insurance Charges by Smoking Status\") +\n  xlab(\"Smoker (Y/N)\") +\n  ylab(\"Insurance Charges\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![a violin plot depicting differences in insurance charges based on smoker status](ggplot2_files/figure-html/plot-smoker-charges-1.png){fig-alt='the figure' width=768}\n:::\n\n```{.r .cell-code}\n#plot above plot without using plot = argument\nggsave(\"plots/plot2:smoker.png\",\n       width = 10, height = 8, dpi = 300)\n```\n:::\n\n\nTo learn more about how to use violin plots for pre/post data, go to the next chapter on visualizing pre/post scores.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}